---
title: "3. LogisticGrowth"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(biPOD)
T <- 3
time_steps <- 12
delta_t <- T / time_steps
d <- biPOD::sim_stochastic_logistic(n0 = 1000, lambda = 1.5, mu = .2, K = 2000, delta_t = delta_t, steps = time_steps)
```

The `fit` function along with the parameter `growth_type = "logistic"` can be used to fit a model over an input dataframe assuming a logistic growth.
With a logistic growth, the function accepts a new argument:

- `prior_K` : a value defining the prior knwoledge of the carrying capacity. Can also be set to `NULL`   

Additionally, one can tune many additional parameters for specific purposes:

- `chains`, `iter`, `warmup`, `cores` : parameters for the MCMC algorithm

A fit with fixed rates can be obtained without adding any `group` column to the input dataframe.

```{r fit log mcmc, results=FALSE, message=FALSE}
x <- biPOD::init(d, "logistic sample using MCMC")
biPOD::plot_input(x)
x <- biPOD::fit(x, growth_type = "logistic")
```

The bipod object does now contains the field `fit`. 
The results of the fit can be visually inspected using:

- `plot_traces` : plot the traces of the MCMC chains, passing as `pars` a vector of desired parameter. You set `diagnose` to `TRUE` to obtain a visual representation about the goodness of the chains.
- `plot_normalized_growth_rate_posteriors` : to plot the normalized posteriors for the growth rates
- `plot_fit` : to plot the fitted curve against the observed data
- `plot`

```{r, results=FALSE, message=FALSE}
biPOD::plot_traces(x, pars = c("rho[1]", "K", "t0"), diagnose = TRUE)
biPOD::plot_normalized_growth_rate_posteriors(x)
biPOD::plot_carrying_capacity_posterior(x)
biPOD::plot_fit(x)
```

The fit can also obtained using variational inference. In order to do so, it is necessary to pass the flag `variational = TRUE` to the `fit` function.

```{r fit log variational, results=FALSE, message=FALSE}
x_variational <- biPOD::init(d, "logistic sample using VB")
x_variational <- biPOD::fit(x_variational, growth_type = "logistic", variational = TRUE)
```

The bipod object does now contain a field named `elbo_data` which contains information regarding the ELBO for every group.
The results of the fit can be visually inspected using with this additional function:

- `plot_elbo` : plot the diagnostic of the ELBO, passing the `diagnose` flag 

```{r, results=FALSE, message=FALSE}
biPOD::plot_elbo(x_variational, diagnose = TRUE)
biPOD::plot_normalized_growth_rate_posteriors(x)
biPOD::plot_carrying_capacity_posterior(x_variational)
biPOD::plot_fit(x_variational)
```
